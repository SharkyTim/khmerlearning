<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Prevent user from zooming on mobile -->
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
  <title>Khmer 100-Card Learning Game</title>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --success-color: #27ae60;
      --text-color: #2c3e50;
    }

    * {
      box-sizing: border-box;
      touch-action: manipulation; /* Helps with mobile tapping */
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #f8f9fa;
      color: var(--text-color);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    .header {
      padding: 20px 0;
    }

    .cards-selection {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 8px;
      margin-bottom: 20px;
    }

    .card-option {
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
      cursor: pointer;
      transition: transform 0.1s;
      user-select: none;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .card-option.selected {
      background: var(--success-color);
      color: white;
      transform: scale(0.98);
    }

    .card-option:active {
      transform: scale(0.96);
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px 0;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      background: var(--secondary-color);
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: opacity 0.2s;
      min-width: 140px;
    }

    button:active {
      opacity: 0.8;
    }

    /* The card section which appears after "Start Practice" */
    .card-section {
      display: none; /* hidden until user starts practice */
      margin-top: 20px;
    }

    .card-container {
      width: 90%;
      max-width: 400px;
      height: 250px;
      margin: 0 auto;
      perspective: 1000px;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }

    .card-flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      padding: 20px;
      background: white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-size: 1.4rem;
      text-align: center;
    }

    .card-back {
      transform: rotateY(180deg);
      background: var(--primary-color);
      color: white;
    }

    /* TTS button in its own container to avoid overlap */
    .tts-container {
      margin-top: 10px;
    }

    .tts-button {
      display: inline-block;
      padding: 10px 16px;
      font-size: 0.9rem;
      background: var(--success-color);
      border-radius: 25px;
      margin-top: 5px;
    }

    @media (max-width: 480px) {
      .card-option {
        font-size: 1rem;
        min-height: 70px;
        padding: 15px;
      }
      button {
        width: 100%;
        padding: 15px;
      }
      .card-container {
        height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <div class="header">
      <h1>Learn Khmer üá∞üá≠</h1>
      <p>Selected: <span id="selected-count">0</span>/100</p>
    </div>

    <!-- SELECTION GRID -->
    <div class="cards-selection" id="cards-selection"></div>

    <!-- INITIAL CONTROLS -->
    <div class="controls">
      <button id="select-all">Select All</button>
      <button id="deselect-all">Deselect All</button>
      <button id="start-training">Start Practice</button>
    </div>

    <!-- CARD SECTION (hidden until we start) -->
    <div class="card-section" id="card-section">
      <div class="card-container" id="card-container">
        <div class="card-inner" id="card-inner">
          <div class="card-face card-front" id="card-front"></div>
          <div class="card-face card-back" id="card-back"></div>
        </div>
      </div>

      <div class="tts-container">
        <button class="tts-button" id="tts-button">Hear Pronunciation üîä</button>
      </div>
    </div>

    <!-- PRACTICE CONTROLS -->
    <div class="controls" id="practice-controls" style="display: none;">
      <button id="got-it">I Know It ‚úÖ</button>
      <button id="try-again">Try Again üîÑ</button>
      <button id="end-session">End Session ‚èπÔ∏è</button>
    </div>
  </div>

  <!-- HIDDEN AUDIO ELEMENT -->
  <audio id="tts-audio"></audio>

  <script>
    /************************************************************
     *  100 VERIFIED KHMER WORDS
     ************************************************************/
    const khmerWords = [
      // (1) Greetings (5)
      { front: '·ûü·ûΩ·ûü·üí·ûè·û∏',      phonetic: 'su≈ès-d√©i',           english: 'Hello',             word: '·ûü·ûΩ·ûü·üí·ûè·û∏' },
      { front: '·ûá·ûò·üí·ûö·û∂·ûî·ûü·ûΩ·ûö',   phonetic: 'chum-reep-su≈èr',    english: 'Formal Greeting',   word: '·ûá·ûò·üí·ûö·û∂·ûî·ûü·ûΩ·ûö' },
      { front: '·û¢·ûö·ûª·ûé·ûü·ûΩ·ûü·üí·ûè·û∏',   phonetic: 'a-run su≈ès-d√©i',    english: 'Good morning',      word: '·û¢·ûö·ûª·ûé·ûü·ûΩ·ûü·üí·ûè·û∏' },
      { front: '·ûö·û∂·ûè·üí·ûö·û∏·ûü·ûΩ·ûü·üí·ûè·û∏', phonetic: 'rea-trei su≈ès-d√©i', english: 'Good night',        word: '·ûö·û∂·ûè·üí·ûö·û∏·ûü·ûΩ·ûü·üí·ûè·û∏' },
      { front: '·ûõ·û∂·û†·ûæ·ûô',      phonetic: 'lia h√¢oy',           english: 'Goodbye',           word: '·ûõ·û∂·û†·ûæ·ûô' },

      // (2) Common Phrases (5)
      { front: '·û¢·ûö·ûÇ·ûª·ûé',       phonetic: 'aw-kohn',            english: 'Thank you',         word: '·û¢·ûö·ûÇ·ûª·ûé' },
      { front: '·ûü·ûª·üÜ·ûë·üÑ·ûü',       phonetic: 'som-toh',            english: 'Sorry',             word: '·ûü·ûª·üÜ·ûë·üÑ·ûü' },
      { front: '·ûî·û∂·ûë',         phonetic: 'baat',               english: 'Yes (male)',        word: '·ûî·û∂·ûë' },
      { front: '·ûÖ·û∂·ûü',         phonetic: 'chaah',              english: 'Yes (female)',      word: '·ûÖ·û∂·ûü' },
      { front: '·ûë·üÅ',          phonetic: 'te',                 english: 'No',                word: '·ûë·üÅ' },

      // (3) Food (5)
      { front: '·ûî·û∂·ûô',         phonetic: 'bai',                english: 'Rice',              word: '·ûî·û∂·ûô' },
      { front: '·ûë·ûπ·ûÄ',         phonetic: 'dt≈≠k',               english: 'Water',             word: '·ûë·ûπ·ûÄ' },
      { front: '·ûè·üí·ûö·û∏',         phonetic: 'trei',               english: 'Fish',              word: '·ûè·üí·ûö·û∏' },
      { front: '·ûü·û∂·ûÖ·üã',        phonetic: 'sach',               english: 'Meat',              word: '·ûü·û∂·ûÖ·üã' },
      { front: '·ûï·üí·ûõ·üÇ·ûà·ûæ',       phonetic: 'plae-chheu',         english: 'Fruit',             word: '·ûï·üí·ûõ·üÇ·ûà·ûæ' },

      // (4) Numbers (10) => 1-10
      { front: '·ûò·ûΩ·ûô',         phonetic: 'mu≈èy',               english: 'One',               word: '·ûò·ûΩ·ûô' },
      { front: '·ûñ·û∏·ûö',         phonetic: 'pƒ´',                 english: 'Two',               word: '·ûñ·û∏·ûö' },
      { front: '·ûî·û∏',          phonetic: 'bei',                english: 'Three',             word: '·ûî·û∏' },
      { front: '·ûî·ûΩ·ûì',         phonetic: 'bu≈èn',               english: 'Four',              word: '·ûî·ûΩ·ûì' },
      { front: '·ûî·üí·ûö·û∂·üÜ',        phonetic: 'prƒÉm',               english: 'Five',              word: '·ûî·üí·ûö·û∂·üÜ' },
      { front: '·ûî·üí·ûö·û∂·üÜ·ûò·ûΩ·ûô',    phonetic: 'prƒÉm-mu≈èy',          english: 'Six',               word: '·ûî·üí·ûö·û∂·üÜ·ûò·ûΩ·ûô' },
      { front: '·ûî·üí·ûö·û∂·üÜ·ûñ·û∏·ûö',    phonetic: 'prƒÉm-pƒ´',            english: 'Seven',             word: '·ûî·üí·ûö·û∂·üÜ·ûñ·û∏·ûö' },
      { front: '·ûî·üí·ûö·û∂·üÜ·ûî·û∏',      phonetic: 'prƒÉm-bei',           english: 'Eight',             word: '·ûî·üí·ûö·û∂·üÜ·ûî·û∏' },
      { front: '·ûî·üí·ûö·û∂·üÜ·ûî·ûΩ·ûì',    phonetic: 'prƒÉm-bu≈èn',          english: 'Nine',              word: '·ûî·üí·ûö·û∂·üÜ·ûî·ûΩ·ûì' },
      { front: '·ûä·ûî·üã',         phonetic: 'dop',                english: 'Ten',               word: '·ûä·ûî·üã' },

      // (5) Family (5)
      { front: '·û™·ûñ·ûª·ûÄ',       phonetic: 'ov puk',             english: 'Father',            word: '·û™·ûñ·ûª·ûÄ' },
      { front: '·ûò·üí·ûè·û∂·ûô',       phonetic: 'mdaay',              english: 'Mother',            word: '·ûò·üí·ûè·û∂·ûô' },
      { front: '·ûî·üí·û¢·ûº·ûì',       phonetic: 'p ºoon',              english: 'Sibling',           word: '·ûî·üí·û¢·ûº·ûì' },
      { front: '·ûî·ûÑ',         phonetic: 'b…ë…ëng',              english: 'Elder sibling',     word: '·ûî·ûÑ' },
      { front: '·ûÄ·ûº·ûì',         phonetic: 'koun',               english: 'Child',             word: '·ûÄ·ûº·ûì' },

      // (6) Time (5)
      { front: '·ûê·üí·ûÑ·üÉ',         phonetic: 'thngay',             english: 'Day',               word: '·ûê·üí·ûÑ·üÉ' },
      { front: '·ûô·ûî·üã',         phonetic: 'yup',                english: 'Night',             word: '·ûô·ûî·üã' },
      { front: '·ûÅ·üÇ',          phonetic: 'khae',               english: 'Month',             word: '·ûÅ·üÇ' },
      { front: '·ûÜ·üí·ûì·û∂·üÜ',        phonetic: 'chnam',              english: 'Year',              word: '·ûÜ·üí·ûì·û∂·üÜ' },
      { front: '·ûò·üâ·üÑ·ûÑ',        phonetic: 'maong',              english: 'Hour',              word: '·ûò·üâ·üÑ·ûÑ' },

      // (7) Colors (5)
      { front: '·ûÄ·üí·ûö·û†·ûò',       phonetic: 'kr…ëh…ë…ëm',            english: 'Red',               word: '·ûÄ·üí·ûö·û†·ûò' },
      { front: '·ûÅ·üÄ·ûú',         phonetic: 'khiev',              english: 'Blue',              word: '·ûÅ·üÄ·ûú' },
      { front: '·ûî·üÉ·ûè·ûÑ',       phonetic: 'bait…ë…ëng',           english: 'Green',             word: '·ûî·üÉ·ûè·ûÑ' },
      { front: '·ûõ·ûø·ûÑ',        phonetic: 'lu…ông',              english: 'Yellow',            word: '·ûõ·ûø·ûÑ' },
      { front: '·ûü',          phonetic: 's…ë…ë',                english: 'White',             word: '·ûü' },

      // (8) Verbs (5)
      { front: '·ûâ·üâ·û∂·üÜ',        phonetic: 'nham',               english: 'Eat',               word: '·ûâ·üâ·û∂·üÜ' },
      { front: '·ûï·ûπ·ûÄ',         phonetic: 'ph…ôk',               english: 'Drink',             word: '·ûï·ûπ·ûÄ' },
      { front: '·ûä·üÅ·ûÄ',         phonetic: 'deek',               english: 'Sleep',             word: '·ûä·üÅ·ûÄ' },
      { front: '·û¢·û∂·ûì',         phonetic: 'aan',                english: 'Read',              word: '·û¢·û∂·ûì' },
      { front: '·ûü·ûö·ûü·üÅ·ûö',       phonetic: 's…ë…ë see',            english: 'Write',             word: '·ûü·ûö·ûü·üÅ·ûö' },

      // (9) Places (5)
      { front: '·ûï·üí·ûë·üá',        phonetic: 'pteah',              english: 'House',             word: '·ûï·üí·ûë·üá' },
      { front: '·ûü·û∂·ûõ·û∂',       phonetic: 'sa-la',              english: 'School',            word: '·ûü·û∂·ûõ·û∂' },
      { front: '·ûï·üí·ûü·û∂·ûö',       phonetic: 'psaa',               english: 'Market',            word: '·ûï·üí·ûü·û∂·ûö' },
      { front: '·ûú·ûè·üí·ûè',        phonetic: 'v≈è…ôt',               english: 'Pagoda',            word: '·ûú·ûè·üí·ûè' },
      { front: '·ûö·ûä·üí·ûã·û∂·ûó·û∑·ûî·û∂·ûõ',  phonetic: 'r≈è…ôtthaaphi ºbaal',   english: 'Government',        word: '·ûö·ûä·üí·ûã·û∂·ûó·û∑·ûî·û∂·ûõ' },

      // (10) Animals (5)
      { front: '·ûÜ·üí·ûÄ·üÇ',        phonetic: 'chhkae',             english: 'Dog',               word: '·ûÜ·üí·ûÄ·üÇ' },
      { front: '·ûÜ·üí·ûò·û∂',        phonetic: 'chhmaa',             english: 'Cat',               word: '·ûÜ·üí·ûò·û∂' },
      { front: '·ûÇ·üÑ',         phonetic: 'koo',                english: 'Cow',               word: '·ûÇ·üÑ' },
      { front: '·ûò·û∂·ûì·üã',        phonetic: 'm≈è…ôn',               english: 'Chicken',           word: '·ûò·û∂·ûì·üã' },
      { front: '·ûÄ·ûÑ·üí·ûÄ·üÇ·ûî',       phonetic: 'k…ëngkaep',           english: 'Frog',              word: '·ûÄ·ûÑ·üí·ûÄ·üÇ·ûî' },

      // (11) Body Parts (5)
      { front: '·ûÄ·üí·ûî·û∂·ûõ',       phonetic: 'kbaal',              english: 'Head',              word: '·ûÄ·üí·ûî·û∂·ûõ' },
      { front: '·ûä·üÉ',         phonetic: 'day',                english: 'Hand',              word: '·ûä·üÉ' },
      { front: '·ûá·ûæ·ûÑ',        phonetic: 'c…ô…ông',              english: 'Leg',               word: '·ûá·ûæ·ûÑ' },
      { front: '·ûó·üí·ûì·üÇ·ûÄ',       phonetic: 'pn…õ…õk',              english: 'Eye',               word: '·ûó·üí·ûì·üÇ·ûÄ' },
      { front: '·ûè·üí·ûö·ûÖ·üÄ·ûÄ',       phonetic: 'tr…ëci…ôk',            english: 'Ear',               word: '·ûè·üí·ûö·ûÖ·üÄ·ûÄ' },

      // (12) Weather (5)
      { front: '·ûó·üí·ûõ·üÄ·ûÑ',       phonetic: 'phli…ông',            english: 'Rain',              word: '·ûó·üí·ûõ·üÄ·ûÑ' },
      { front: '·ûÄ·üí·ûä·üÖ',        phonetic: 'kdao',               english: 'Hot',               word: '·ûÄ·üí·ûä·üÖ' },
      { front: '·ûè·üí·ûö·ûá·û∂·ûÄ·üã',      phonetic: 'tr…ëcheak',           english: 'Cold',              word: '·ûè·üí·ûö·ûá·û∂·ûÄ·üã' },
      { front: '·ûÅ·üí·ûô·ûõ·üã',       phonetic: 'ky…ël',               english: 'Wind',              word: '·ûÅ·üí·ûô·ûõ·üã' },
      { front: '·ûñ·ûì·üí·ûõ·û∫',        phonetic: 'p≈≠…ônl…®…®',             english: 'Light',             word: '·ûñ·ûì·üí·ûõ·û∫' },

      // (13) Transportation (5)
      { front: '·ûö·ûê·ûô·ûì·üí·ûè',      phonetic: 'r…î…ît y≈≠…ôn',          english: 'Car',               word: '·ûö·ûê·ûô·ûì·üí·ûè' },
      { front: '·ûò·üâ·ûº·ûè·ûº',       phonetic: 'moutou',             english: 'Motorcycle',        word: '·ûò·üâ·ûº·ûè·ûº' },
      { front: '·ûô·û∂·ûì·ûä·üí·ûã·û∂·ûì',     phonetic: 'yien t ∞aan',         english: 'Bus Station',       word: '·ûô·û∂·ûì·ûä·üí·ûã·û∂·ûì' },
      { front: '·ûô·ûì·üí·ûè·û†·üÑ·üá',     phonetic: 'y≈≠…ôn h…ëh',           english: 'Airplane',          word: '·ûô·ûì·üí·ûè·û†·üÑ·üá' },
      { front: '·ûë·ûº·ûÄ',        phonetic: 'tuuk',               english: 'Boat',              word: '·ûë·ûº·ûÄ' },

      // (14) Technology (5)
      { front: '·ûë·ûº·ûö·ûü·üê·ûñ·üí·ûë',     phonetic: 'tuurasap',           english: 'Phone',             word: '·ûë·ûº·ûö·ûü·üê·ûñ·üí·ûë' },
      { front: '·ûÄ·ûª·üÜ·ûñ·üí·ûô·ûº·ûë·üê·ûö',   phonetic: 'kompyuut…î…ô',         english: 'Computer',          word: '·ûÄ·ûª·üÜ·ûñ·üí·ûô·ûº·ûë·üê·ûö' },
      { front: '·û¢·üä·û∏·ûì·ûí·û∫·ûé·û∑·ûè',   phonetic: 'int…®…®n…ôt',           english: 'Internet',          word: '·û¢·üä·û∏·ûì·ûí·û∫·ûé·û∑·ûè' },
      { front: '·ûÄ·û∂·ûò·üÅ·ûö·üâ·û∂',     phonetic: 'kaameeraa',          english: 'Camera',            word: '·ûÄ·û∂·ûò·üÅ·ûö·üâ·û∂' },
      { front: '·ûê·û∂·ûò·ûñ·ûõ',       phonetic: 'thaam…ëp≈≠…ôl',         english: 'Energy',            word: '·ûê·û∂·ûò·ûñ·ûõ' },

      // (15) Emotions (5)
      { front: '·ûö·û∏·ûÄ·ûö·û∂·ûô',      phonetic: 'rik-reay',           english: 'Happy',             word: '·ûö·û∏·ûÄ·ûö·û∂·ûô' },
      { front: '·ûü·ûî·üí·ûî·û∂·ûô·ûÖ·û∑·ûè·üí·ûè',  phonetic: 'sab-bay-chet',       english: 'Joyful',            word: '·ûü·ûî·üí·ûî·û∂·ûô·ûÖ·û∑·ûè·üí·ûè' },
      { front: '·ûñ·üí·ûö·ûΩ·ûô·ûî·û∂·ûö·ûò·üí·ûó', phonetic: 'pruoy ba-rom',       english: 'Worried',           word: '·ûñ·üí·ûö·ûΩ·ûô·ûî·û∂·ûö·ûò·üí·ûó' },
      { front: '·ûÅ·ûπ·ûÑ',        phonetic: 'kh…ông',              english: 'Angry',             word: '·ûÅ·ûπ·ûÑ' },
      { front: '·ûü·üí·ûö·û°·û∂·ûâ·üã',     phonetic: 'sralanh',            english: 'To love',           word: '·ûü·üí·ûö·û°·û∂·ûâ·üã' },

      // (16) Clothes (5)
      { front: '·û¢·û∂·ûú',         phonetic: 'aav',                english: 'Shirt',             word: '·û¢·û∂·ûú' },
      { front: '·ûÅ·üÑ',         phonetic: 'khaov',              english: 'Pants',             word: '·ûÅ·üÑ' },
      { front: '·ûü·üí·ûî·üÇ·ûÄ·ûá·ûæ·ûÑ',     phonetic: 'sbaek-j…ô…ông',        english: 'Shoes',             word: '·ûü·üí·ûî·üÇ·ûÄ·ûá·ûæ·ûÑ' },
      { front: '·ûò·ûΩ·ûÄ',        phonetic: 'mu≈èk',               english: 'Hat',               word: '·ûò·ûΩ·ûÄ' },
      { front: '·ûü·üÜ·ûñ·ûè·üã',       phonetic: 'som-pot',            english: 'Skirt',             word: '·ûü·üÜ·ûñ·ûè·üã' },

      // (17) Days of the Week (7)
      { front: '·ûê·üí·ûÑ·üÉ·û¢·û∂·ûë·û∑·ûè·üí·ûô',  phonetic: 'thngay aa-tit',      english: 'Sunday',            word: '·ûê·üí·ûÑ·üÉ·û¢·û∂·ûë·û∑·ûè·üí·ûô' },
      { front: '·ûê·üí·ûÑ·üÉ·ûÖ·ûì·üí·ûë',      phonetic: 'thngay chan',        english: 'Monday',            word: '·ûê·üí·ûÑ·üÉ·ûÖ·ûì·üí·ûë' },
      { front: '·ûê·üí·ûÑ·üÉ·û¢·ûÑ·üí·ûÇ·û∂·ûö',    phonetic: 'thngay ong-kea',     english: 'Tuesday',           word: '·ûê·üí·ûÑ·üÉ·û¢·ûÑ·üí·ûÇ·û∂·ûö' },
      { front: '·ûê·üí·ûÑ·üÉ·ûñ·ûª·ûí',       phonetic: 'thngay puth',        english: 'Wednesday',         word: '·ûê·üí·ûÑ·üÉ·ûñ·ûª·ûí' },
      { front: '·ûê·üí·ûÑ·üÉ·ûñ·üí·ûö·û†·ûü·üí·ûî·ûè·û∑·üç', phonetic: 'thngay pro-hos',     english: 'Thursday',          word: '·ûê·üí·ûÑ·üÉ·ûñ·üí·ûö·û†·ûü·üí·ûî·ûè·û∑·üç' },
      { front: '·ûê·üí·ûÑ·üÉ·ûü·ûª·ûÄ·üí·ûö',      phonetic: 'thngay sok',         english: 'Friday',            word: '·ûê·üí·ûÑ·üÉ·ûü·ûª·ûÄ·üí·ûö' },
      { front: '·ûê·üí·ûÑ·üÉ·ûü·üÖ·ûö·üç',      phonetic: 'thngay sao',         english: 'Saturday',          word: '·ûê·üí·ûÑ·üÉ·ûü·üÖ·ûö·üç' },

      // (18) Months (7) => 100 total
      { front: '·ûò·ûÄ·ûö·û∂',         phonetic: 'm√¥k-kaa-ra',         english: 'January',           word: '·ûò·ûÄ·ûö·û∂' },
      { front: '·ûÄ·ûª·ûò·üí·ûó·üà',       phonetic: 'k≈èm-pheƒÉk',           english: 'February',          word: '·ûÄ·ûª·ûò·üí·ûó·üà' },
      { front: '·ûò·û∑·ûì·û∂',         phonetic: 'me-niia',            english: 'March',             word: '·ûò·û∑·ûì·û∂' },
      { front: '·ûò·üÅ·ûü·û∂',         phonetic: 'me-sa',              english: 'April',             word: '·ûò·üÅ·ûü·û∂' },
      { front: '·ûß·ûü·ûó·û∂',         phonetic: 'ou-sa-phiia',         english: 'May',               word: '·ûß·ûü·ûó·û∂' },
      { front: '·ûò·û∑·ûê·ûª·ûì·û∂',       phonetic: 'mi-thu-naa',          english: 'June',              word: '·ûò·û∑·ûê·ûª·ûì·û∂' },
      { front: '·ûÄ·ûÄ·üí·ûÄ·ûä·û∂',        phonetic: 'kƒÉk-kƒÉ-daa',          english: 'July',              word: '·ûÄ·ûÄ·üí·ûÄ·ûä·û∂' },
    ];

    /************************************************************
     *  GLOBAL STATE
     ************************************************************/
    let selectedIndexes = [];
    let currentIndex = -1;
    let isCardFlipped = false;
    let currentWord = ''; // For TTS

    // DOM references
    const cardsSelection = document.getElementById('cards-selection');
    const selectedCountSpan = document.getElementById('selected-count');

    const selectAllBtn = document.getElementById('select-all');
    const deselectAllBtn = document.getElementById('deselect-all');
    const startTrainingBtn = document.getElementById('start-training');

    const cardSection = document.getElementById('card-section');
    const cardContainer = document.getElementById('card-container');
    const cardInner = document.getElementById('card-inner');
    const cardFront = document.getElementById('card-front');
    const cardBack = document.getElementById('card-back');

    const practiceControls = document.getElementById('practice-controls');
    const gotItBtn = document.getElementById('got-it');
    const tryAgainBtn = document.getElementById('try-again');
    const endSessionBtn = document.getElementById('end-session');

    const ttsButton = document.getElementById('tts-button');
    const ttsAudio = document.getElementById('tts-audio');

    /************************************************************
     *  1) GENERATE CARD SELECTION
     ************************************************************/
    khmerWords.forEach((wordObj, index) => {
      const div = document.createElement('div');
      div.classList.add('card-option');
      div.textContent = wordObj.front; // Show Khmer script in selection

      div.addEventListener('click', () => {
        // Toggle selection
        if (selectedIndexes.includes(index)) {
          // Deselect
          selectedIndexes = selectedIndexes.filter(i => i !== index);
          div.classList.remove('selected');
        } else {
          // Select
          selectedIndexes.push(index);
          div.classList.add('selected');
        }
        selectedCountSpan.textContent = selectedIndexes.length;
      });

      cardsSelection.appendChild(div);
    });

    /************************************************************
     *  2) SELECT/DESELECT ALL
     ************************************************************/
    selectAllBtn.addEventListener('click', () => {
      selectedIndexes = khmerWords.map((_, i) => i); // all indices
      selectedCountSpan.textContent = selectedIndexes.length;

      document.querySelectorAll('.card-option').forEach((cardOption) => {
        cardOption.classList.add('selected');
      });
    });

    deselectAllBtn.addEventListener('click', () => {
      selectedIndexes = [];
      selectedCountSpan.textContent = 0;

      document.querySelectorAll('.card-option').forEach((cardOption) => {
        cardOption.classList.remove('selected');
      });
    });

    /************************************************************
     *  3) START PRACTICE
     ************************************************************/
    startTrainingBtn.addEventListener('click', () => {
      if (selectedIndexes.length === 0) {
        alert('Please select at least one card before starting.');
        return;
      }

      // Hide selection UI
      cardsSelection.style.display = 'none';
      selectAllBtn.style.display = 'none';
      deselectAllBtn.style.display = 'none';
      startTrainingBtn.style.display = 'none';

      // Show card + practice controls
      cardSection.style.display = 'block';
      practiceControls.style.display = 'flex';

      // Shuffle the selected cards
      shuffleArray(selectedIndexes);

      currentIndex = 0;
      showCard(currentIndex);
    });

    /************************************************************
     *  4) PRACTICE CONTROLS
     ************************************************************/
    // "I Know It" => remove card from deck
    gotItBtn.addEventListener('click', () => {
      selectedIndexes.splice(currentIndex, 1);
      if (selectedIndexes.length === 0) {
        alert('Awesome! You finished all cards.');
        endSession();
        return;
      }
      if (currentIndex >= selectedIndexes.length) {
        currentIndex = 0;
      }
      showCard(currentIndex);
    });

    // "Try Again" => keep card, just go next
    tryAgainBtn.addEventListener('click', () => {
      currentIndex++;
      if (currentIndex >= selectedIndexes.length) {
        currentIndex = 0;
      }
      showCard(currentIndex);
    });

    // "End Session"
    endSessionBtn.addEventListener('click', () => {
      endSession();
    });

    // Flip card on container click (but not the TTS button)
    cardContainer.addEventListener('click', (e) => {
      if (!e.target.classList.contains('tts-button')) {
        flipCard();
      }
    });

    /************************************************************
     *  5) TTS BUTTON
     ************************************************************/
    ttsButton.addEventListener('click', () => {
      if (!ttsAudio.src) {
        // Should not happen if we always load TTS in showCard()
        alert('Audio not ready yet. Please try again.');
        return;
      }
      // Attempt to play
      ttsAudio.play().catch(err => {
        console.log('Audio play error:', err);
        alert('Audio blocked. Please ensure your device is not on silent and try again.');
      });
    });

    /************************************************************
     *  HELPER FUNCTIONS
     ************************************************************/

    // Show card (front/back) for the current index
    function showCard(idx) {
      cardContainer.classList.remove('card-flipped');
      isCardFlipped = false;

      const w = khmerWords[selectedIndexes[idx]];

      // Front: Khmer script
      cardFront.textContent = w.front;
      // Back: phonetic + English
      cardBack.innerHTML = `
        <div>${w.phonetic}</div>
        <div style="margin-top:8px; font-size:0.9em;">${w.english}</div>
      `;

      currentWord = w.word;
      preloadTTS(currentWord);
    }

    // Flip card
    function flipCard() {
      isCardFlipped = !isCardFlipped;
      if (isCardFlipped) {
        cardContainer.classList.add('card-flipped');
      } else {
        cardContainer.classList.remove('card-flipped');
      }
    }

    // End session => show selection again, clear everything
    function endSession() {
      // Show selection
      cardsSelection.style.display = 'grid';
      selectAllBtn.style.display = 'inline-block';
      deselectAllBtn.style.display = 'inline-block';
      startTrainingBtn.style.display = 'inline-block';

      // Hide practice
      cardSection.style.display = 'none';
      practiceControls.style.display = 'none';

      // Clear selections
      selectedIndexes = [];
      selectedCountSpan.textContent = 0;

      // Unselect UI
      document.querySelectorAll('.card-option').forEach(div => {
        div.classList.remove('selected');
      });
    }

    // Shuffle array in-place
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    // Preload TTS audio for the given Khmer word
    function preloadTTS(text) {
      // Using client=gtx for broader mobile compatibility
      const baseURL = 'https://translate.google.com/translate_tts?ie=UTF-8&client=gtx&tl=km';
      const audioUrl = `${baseURL}&q=${encodeURIComponent(text)}`;

      ttsAudio.src = audioUrl;
      ttsAudio.load(); // Attempt to preload
    }

  </script>
</body>
</html>
