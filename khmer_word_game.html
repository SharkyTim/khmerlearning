<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Prevent user from zooming on mobile -->
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
  <title>Khmer Word Game (Audio)</title>
  <style>
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --success-color: #27ae60;
      --text-color: #2c3e50;
    }

    * {
      box-sizing: border-box;
      touch-action: manipulation; /* Helps with mobile tapping */
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #f8f9fa;
      color: var(--text-color);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    .header {
      padding: 20px 0;
    }

    .cards-selection {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 8px;
      margin-bottom: 20px;
    }

    .card-option {
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
      cursor: pointer;
      transition: transform 0.1s;
      user-select: none;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .card-option.selected {
      background: var(--success-color);
      color: white;
      transform: scale(0.98);
    }

    .card-option:active {
      transform: scale(0.96);
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px 0;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      background: var(--secondary-color);
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: opacity 0.2s;
      min-width: 140px;
    }

    button:active {
      opacity: 0.8;
    }

    /* The card section which appears after "Start Practice" */
    .card-section {
      display: none; /* hidden until user starts practice */
      margin-top: 20px;
    }

    .card-container {
      width: 90%;
      max-width: 400px;
      height: 250px;
      margin: 0 auto;
      perspective: 1000px;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
    }

    .card-flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      padding: 20px;
      background: white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      font-size: 1.4rem;
      text-align: center;
    }

    .card-back {
      transform: rotateY(180deg);
      background: var(--primary-color);
      color: white;
    }

    /* TTS/Audio button */
    .tts-container {
      margin-top: 10px;
    }

    .tts-button {
      display: inline-block;
      padding: 10px 16px;
      font-size: 0.9rem;
      background: var(--success-color);
      border-radius: 25px;
      margin-top: 5px;
      cursor: pointer;
      color: white;
      border: none;
    }

    @media (max-width: 480px) {
      .card-option {
        font-size: 1rem;
        min-height: 70px;
        padding: 15px;
      }
      button {
        width: 100%;
        padding: 15px;
      }
      .card-container {
        height: 220px;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <div class="header">
      <h1>Learn Khmer üá∞üá≠</h1>
      <p>Selected: <span id="selected-count">0</span></p>
    </div>

    <!-- SELECTION GRID -->
    <div class="cards-selection" id="cards-selection"></div>

    <!-- INITIAL CONTROLS -->
    <div class="controls">
      <button id="select-all">Select All</button>
      <button id="deselect-all">Deselect All</button>
      <button id="start-training">Start Practice</button>
    </div>

    <!-- CARD SECTION (hidden until we start) -->
    <div class="card-section" id="card-section">
      <div class="card-container" id="card-container">
        <div class="card-inner" id="card-inner">
          <div class="card-face card-front" id="card-front"></div>
          <div class="card-face card-back" id="card-back"></div>
        </div>
      </div>

      <div class="tts-container">
        <button class="tts-button" id="tts-button">Hear Pronunciation üîä</button>
      </div>
    </div>

    <!-- PRACTICE CONTROLS -->
    <div class="controls" id="practice-controls" style="display: none;">
      <button id="got-it">I Know It ‚úÖ</button>
      <button id="try-again">Try Again üîÑ</button>
      <button id="end-session">End Session ‚èπÔ∏è</button>
    </div>
  </div>

  <!-- HIDDEN AUDIO ELEMENT (no autoplay to avoid mobile blocking) -->
  <audio id="tts-audio" playsinline></audio>

  <script>
    /******************************************************
     * Only the words that have a matching .mp3 in GitHub
     ******************************************************/
    const khmerWords = [
      {
        front: '·ûô·ûì·üí·ûè·û†·üÑ·üá', phonetic: 'y≈≠…ôn h…ëh', english: 'Airplane',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/airplane.mp3'
      },
      {
        front: '·ûÅ·ûπ·ûÑ', phonetic: 'kh…ông', english: 'Angry',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/angry.mp3'
      },
      {
        front: '·ûÅ·üí·ûò·üÖ', phonetic: 'khmaw', english: 'Black',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/black.mp3'
      },
      {
        front: '·ûÅ·üÄ·ûú', phonetic: 'khiev', english: 'Blue',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/blue.mp3'
      },
      {
        front: '·ûë·ûº·ûÄ', phonetic: 'tuuk', english: 'Boat',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/boat.mp3'
      },
      {
        front: '·ûö·û∂·ûÑ·ûÄ·û∂·ûô', phonetic: 'reang-gaay', english: 'Body',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/body.mp3'
      },
      {
        front: '·ûü·üÄ·ûú·ûó·üÖ', phonetic: 'sieow-phev', english: 'Book',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/book.mp3'
      },
      {
        front: '·ûô·û∂·ûì·ûä·üí·ûã·û∂·ûì', phonetic: 'yaan-dthan', english: 'Bus',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/bus.mp3'
      },
      {
        front: '·ûÄ·û∂·ûò·üÅ·ûö·üâ·û∂', phonetic: 'kaa-mee-ra', english: 'Camera',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/camera.mp3'
      },
      {
        front: '·ûö·ûê·ûô·ûì·üí·ûè', phonetic: 'roth-yun', english: 'Car',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/car.mp3'
      },
      {
        front: '·ûè·üí·ûö·ûá·û∂·ûÄ·üã', phonetic: 'tr…ë-cheak', english: 'Cold',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/cold.mp3'
      },
      {
        front: '·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª·ûè·üí·ûö·ûá·û∂·ûÄ·üã', phonetic: 'a-kaa-t…ô-tro-cheak', english: 'Cold Weather',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/cold_weather.mp3'
      },
      {
        front: '·ûÄ·ûª·üÜ·ûñ·üí·ûô·ûº·ûë·üê·ûö', phonetic: 'kom-pyu-tor', english: 'Computer',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/computer.mp3'
      },
      {
        front: '·ûî·üí·ûö·ûë·üÅ·ûü', phonetic: 'bpra-teh', english: 'Country',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/country.mp3'
      },
      {
        front: '·ûÜ·üí·ûÑ·û∂·ûâ·üã', phonetic: 'chhnganh', english: 'Delicious',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/delicious.mp3'
      },
      {
        front: '·ûî·ûæ·ûÄ', phonetic: 'baerk', english: 'Drive',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/drive.mp3'
      },
      {
        front: '·ûè·üí·ûö·ûÖ·üÄ·ûÄ', phonetic: 'tr…ë-chiek', english: 'Ear',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/ear.mp3'
      },
      {
        front: '·ûâ·üâ·û∂·üÜ', phonetic: 'nham', english: 'Eat',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/eat.mp3'
      },
      {
        front: '·ûî·üí·ûö·û∂·üÜ·ûî·û∏', phonetic: 'prƒÉm-bei', english: 'Eight',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/eight.mp3'
      },
      {
        front: '·ûê·û∂·ûò·ûñ·ûõ', phonetic: 'thaa-m…ë-p…îl', english: 'Energy',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/energy.mp3'
      },
      {
        front: '·ûó·üí·ûì·üÇ·ûÄ', phonetic: 'phnek', english: 'Eye',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/eye.mp3'
      },
      {
        front: '·û™·ûñ·ûª·ûÄ', phonetic: 'av-puk', english: 'Father',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/father.mp3'
      },
      {
        front: '·ûè·üí·ûö·û∏', phonetic: 'trei', english: 'Fish',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/fish.mp3'
      },
      {
        front: '·ûî·üí·ûö·û∂·üÜ', phonetic: 'prƒÉm', english: 'Five',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/five.mp3'
      },
      {
        front: '·ûá·ûò·üí·ûö·û∂·ûî·ûü·ûΩ·ûö', phonetic: 'chum-reep-su≈èr', english: 'Formal Greeting',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/formal_greeting.mp3'
      },
      {
        front: '·ûî·ûΩ·ûì', phonetic: 'bu≈èn', english: 'Four',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/four.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·ûü·ûª·ûÄ·üí·ûö', phonetic: 'thngay sok', english: 'Friday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/friday.mp3'
      },
      {
        front: '·ûò·û∑·ûè·üí·ûè', phonetic: 'mit', english: 'Friend',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/friend.mp3'
      },
      {
        front: '·ûï·üí·ûõ·üÇ·ûà·ûæ', phonetic: 'plae-chheu', english: 'Fruit',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/fruit.mp3'
      },
      {
        front: '·û¢·ûö·ûª·ûé·ûü·ûΩ·ûü·üí·ûè·û∏', phonetic: 'a-run su≈ès-d√©i', english: 'Good morning',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/good_morning.mp3'
      },
      {
        front: '·ûö·û∂·ûè·üí·ûö·û∏·ûü·ûΩ·ûü·üí·ûè·û∏', phonetic: 'rea-trei su≈ès-d√©i', english: 'Good night',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/good_night.mp3'
      },
      {
        front: '·ûõ·û∂·û†·ûæ·ûô', phonetic: 'lia h√¢oy', english: 'Goodbye',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/goodbye.mp3'
      },
      {
        front: '·ûî·üÉ·ûè·ûÑ', phonetic: 'bay-t…ëng', english: 'Green',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/green.mp3'
      },
      {
        front: '·ûä·üÉ', phonetic: 'day', english: 'Hand',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/hand.mp3'
      },
      {
        front: '·ûö·û∏·ûÄ·ûö·û∂·ûô', phonetic: 'rik-reay', english: 'Happy',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/happy.mp3'
      },
      {
        front: '·ûò·ûΩ·ûÄ', phonetic: 'mu≈èk', english: 'Hat',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/hat.mp3'
      },
      {
        front: '·ûÄ·üí·ûî·û∂·ûõ', phonetic: 'kbaal', english: 'Head',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/head.mp3'
      },
      {
        front: '·ûü·ûΩ·ûü·üí·ûè·û∏', phonetic: 'su≈ès-d√©i', english: 'Hello',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/hello.mp3'
      },
      {
        front: '·ûÄ·üí·ûä·üÖ', phonetic: 'kdao', english: 'Hot',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/hot.mp3'
      },
      {
        front: '·û¢·û∂·ûÄ·û∂·ûü·ûí·û∂·ûè·ûª·ûÄ·üí·ûä·üÖ', phonetic: 'a-kaa-t…ô-kdao', english: 'Hot Weather',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/hot_weather.mp3'
      },
      {
        front: '·ûï·üí·ûë·üá', phonetic: 'pteah', english: 'House',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/house.mp3'
      },
      {
        front: '·ûÉ·üí·ûõ·û∂·ûì', phonetic: 'khlean', english: 'Hungry',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/hungry.mp3'
      },
      {
        front: '·ûÅ·üí·ûâ·ûª·üÜ', phonetic: 'khnhom', english: 'I / Me',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/i_me.mp3'
      },
      {
        front: '·û¢·üä·û∏·ûì·ûí·û∫·ûé·û∑·ûè', phonetic: 'in-th…®-n…ôt', english: 'Internet',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/internet.mp3'
      },
      {
        front: '·ûá·ûæ·ûÑ', phonetic: 'ch…ô…ông', english: 'Leg',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/leg.mp3'
      },
      {
        front: '·ûñ·ûì·üí·ûõ·û∫', phonetic: 'pon-leu', english: 'Light',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/light.mp3'
      },
      {
        front: '·ûü·û∂·ûÖ·üã', phonetic: 'sach', english: 'Meat',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/meat.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·ûÖ·ûì·üí·ûë', phonetic: 'thngay chan', english: 'Monday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/monday.mp3'
      },
      {
        front: '·ûò·üâ·üÇ', phonetic: 'me', english: 'Mother',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/mother.mp3'
      },
      {
        front: '·ûò·üâ·ûº·ûè·ûº', phonetic: 'moto', english: 'Motorcycle',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/motorcycle.mp3'
      },
      {
        front: '·ûî·üí·ûö·û∂·üÜ·ûî·ûΩ·ûì', phonetic: 'prƒÉm-bu≈èn', english: 'Nine',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/nine.mp3'
      },
      {
        front: '·ûë·üÅ', phonetic: 'te', english: 'No',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/no.mp3'
      },
      {
        front: '·ûò·û∑·ûì·û¢·û∏·ûë·üÅ', phonetic: 'min-ey-te', english: 'No Problem',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/no_problem.mp3'
      },
      {
        front: '·ûò·ûΩ·ûô', phonetic: 'mu≈èy', english: 'One',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/one.mp3'
      },
      {
        front: '·ûÅ·üÑ', phonetic: 'khao', english: 'Pants',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/pants.mp3'
      },
      {
        front: '·ûó·üí·ûì·üÜ·ûñ·üÅ·ûâ', phonetic: 'phnom penh', english: 'Phnom Penh',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/phnom_penh.mp3'
      },
      {
        front: '·ûë·ûº·ûö·ûü·üê·ûñ·üí·ûë', phonetic: 'tuu-r…ô-sap', english: 'Phone',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/phone.mp3'
      },
      {
        front: '·û¢·ûâ·üí·ûá·ûæ·ûâ', phonetic: 'anh-jerng', english: 'Please invite',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/please_invite.mp3'
      },
      {
        front: '·ûî·üâ·ûº·ûõ·û∏·ûü', phonetic: 'po-leas', english: 'Police',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/police.mp3'
      },
      {
        front: '·ûó·üí·ûõ·üÄ·ûÑ', phonetic: 'phli…ông', english: 'Rain',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/rain.mp3'
      },
      {
        front: '·ûó·üí·ûõ·üÄ·ûÑ', phonetic: 'phli…ông', english: 'Rainy',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/rainy.mp3'
      },
      {
        front: '·ûÄ·üí·ûö·û†·ûò', phonetic: 'kr…ë-h…ëm', english: 'Red',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/red.mp3'
      },
      {
        front: '·ûî·û∂·ûô', phonetic: 'bai', english: 'Rice',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/rice.mp3'
      },
      {
        front: '·ûö·ûè·üã', phonetic: 'r…ît', english: 'Run',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/run.mp3'
      },
      {
        front: '·ûÄ·üÜ·ûü·ûè·üã', phonetic: 'k…ëmsat', english: 'Sad',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/sad.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·ûü·üÖ·ûö·üç', phonetic: 'thngay sao', english: 'Saturday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/saturday.mp3'
      },
      {
        front: '·ûü·û∂·ûõ·û∂', phonetic: 'sa-la', english: 'School',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/school.mp3'
      },
      {
        front: '·ûî·üí·ûö·û∂·üÜ·ûñ·û∏·ûö', phonetic: 'prƒÉm-pƒ´', english: 'Seven',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/seven.mp3'
      },
      {
        front: '·û¢·û∂·ûú', phonetic: 'aav', english: 'Shirt',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/shirt.mp3'
      },
      {
        front: '·ûü·üí·ûî·üÇ·ûÄ·ûá·ûæ·ûÑ', phonetic: 'sbaek-j…ô…ông', english: 'Shoes',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/shoes.mp3'
      },
      {
        front: '·ûî·üí·ûö·û∂·üÜ·ûò·ûΩ·ûô', phonetic: 'prƒÉm-mu≈èy', english: 'Six',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/six.mp3'
      },
      {
        front: '·ûü·üÜ·ûñ·ûè·üã', phonetic: 'som-pot', english: 'Skirt',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/skirt.mp3'
      },
      {
        front: '·ûü·ûª·üÜ·ûë·üÑ·ûü', phonetic: 'som-toh', english: 'Sorry',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/sorry.mp3'
      },
      {
        front: '·ûü·û∑·ûü·üí·ûü', phonetic: 's…®s', english: 'Student',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/student.mp3'
      },
      {
        front: '·ûü·û∑·ûÄ·üí·ûü·û∂', phonetic: 's…®k-sa', english: 'Study',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/study.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·û¢·û∂·ûë·û∑·ûè·üí·ûô', phonetic: 'thngay aa-tit', english: 'Sunday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/sunday.mp3'
      },
      {
        front: '·ûÇ·üí·ûö·ûº', phonetic: 'kruu', english: 'Teacher',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/teacher.mp3'
      },
      {
        front: '·ûë·ûº·ûö·ûü·üê·ûñ·üí·ûë', phonetic: 'tuu-r…ô-sap', english: 'Telephone',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/telephone.mp3'
      },
      {
        front: '·ûä·ûî·üã', phonetic: 'dop', english: 'Ten',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/ten.mp3'
      },
      {
        front: '·û¢·ûö·ûÇ·ûª·ûé', phonetic: 'aw-kohn', english: 'Thank you',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/thank_you.mp3'
      },
      {
        front: '·û¢·ûö·ûÇ·ûª·ûé', phonetic: 'aw-kohn', english: 'Thankful',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/thankful.mp3'
      },
      {
        front: '·ûî·û∏', phonetic: 'bei', english: 'Three',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/three.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·ûñ·üí·ûö·û†·ûü·üí·ûî·ûè·û∑·üç', phonetic: 'thngay pro-hos', english: 'Thursday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/thursday.mp3'
      },
      {
        front: '·ûì·ûø·ûô·û†·ûè·üã', phonetic: 'nu…ôy-hat', english: 'Tired',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/tired.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·û¢·ûÑ·üí·ûÇ·û∂·ûö', phonetic: 'thngay ong-kea', english: 'Tuesday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/tuesday.mp3'
      },
      {
        front: '·ûñ·û∏·ûö', phonetic: 'pii', english: 'Two',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/two.mp3'
      },
      {
        front: '·ûî·ûì·üí·ûõ·üÇ', phonetic: 'banlae', english: 'Vegetable',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/vegetable.mp3'
      },
      {
        front: '·ûä·ûæ·ûö', phonetic: 'daer', english: 'Walk',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/walk.mp3'
      },
      {
        front: '·ûë·ûπ·ûÄ', phonetic: 'dt≈≠k', english: 'Water',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/water.mp3'
      },
      {
        front: '·ûê·üí·ûÑ·üÉ·ûñ·ûª·ûí', phonetic: 'thngay puth', english: 'Wednesday',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/wednesday.mp3'
      },
      {
        front: '·ûü', phonetic: 's…ë…ë', english: 'White',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/white.mp3'
      },
      {
        front: '·ûÅ·üí·ûô·ûõ·üã', phonetic: 'khy…ël', english: 'Wind',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/wind.mp3'
      },
      {
        front: '·ûÅ·üí·ûô·ûõ·üã', phonetic: 'khy…ël', english: 'Windy',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/windy.mp3'
      },
      {
        front: '·ûÄ·û∂·ûö·ûÑ·û∂·ûö', phonetic: 'kaa-ngiea', english: 'Work',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/work.mp3'
      },
      {
        front: '·ûõ·ûø·ûÑ', phonetic: 'l…®…ông', english: 'Yellow',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/yellow.mp3'
      },
      {
        front: '·ûÖ·û∂·ûü', phonetic: 'chaah', english: 'Yes (female)',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/yes_female.mp3'
      },
      {
        front: '·ûî·û∂·ûë', phonetic: 'baat', english: 'Yes (male)',
        audio: 'https://raw.githubusercontent.com/SharkyTim/khmer-audio/main/audio/yes_male.mp3'
      }
    ];

    /************************************************************
     * Global State
     ************************************************************/
    let selectedIndexes = [];
    let currentIndex = -1;
    let isCardFlipped = false;

    // DOM references
    const cardsSelection    = document.getElementById('cards-selection');
    const selectedCountSpan = document.getElementById('selected-count');
    const selectAllBtn      = document.getElementById('select-all');
    const deselectAllBtn    = document.getElementById('deselect-all');
    const startTrainingBtn  = document.getElementById('start-training');

    const cardSection       = document.getElementById('card-section');
    const cardContainer     = document.getElementById('card-container');
    const cardInner         = document.getElementById('card-inner');
    const cardFront         = document.getElementById('card-front');
    const cardBack          = document.getElementById('card-back');

    const practiceControls  = document.getElementById('practice-controls');
    const gotItBtn          = document.getElementById('got-it');
    const tryAgainBtn       = document.getElementById('try-again');
    const endSessionBtn     = document.getElementById('end-session');

    const ttsButton         = document.getElementById('tts-button');
    const ttsAudio          = document.getElementById('tts-audio');

    /************************************************************
     * 1) Generate Selection Grid
     ************************************************************/
    khmerWords.forEach((wordObj, index) => {
      const div = document.createElement('div');
      div.classList.add('card-option');
      div.textContent = wordObj.front;

      // Toggle selection on click
      div.addEventListener('click', () => {
        if (selectedIndexes.includes(index)) {
          // Deselect
          selectedIndexes = selectedIndexes.filter(i => i !== index);
          div.classList.remove('selected');
        } else {
          // Select
          selectedIndexes.push(index);
          div.classList.add('selected');
        }
        selectedCountSpan.textContent = selectedIndexes.length;
      });

      cardsSelection.appendChild(div);
    });

    /************************************************************
     * 2) Select/Deselect All
     ************************************************************/
    selectAllBtn.addEventListener('click', () => {
      selectedIndexes = khmerWords.map((_, i) => i); // all indices
      selectedCountSpan.textContent = selectedIndexes.length;
      document.querySelectorAll('.card-option').forEach((cardOption) => {
        cardOption.classList.add('selected');
      });
    });

    deselectAllBtn.addEventListener('click', () => {
      selectedIndexes = [];
      selectedCountSpan.textContent = 0;
      document.querySelectorAll('.card-option').forEach((cardOption) => {
        cardOption.classList.remove('selected');
      });
    });

    /************************************************************
     * 3) Start Practice
     ************************************************************/
    startTrainingBtn.addEventListener('click', () => {
      if (selectedIndexes.length === 0) {
        alert('Please select at least one card before starting.');
        return;
      }
      // Hide selection UI
      cardsSelection.style.display = 'none';
      selectAllBtn.style.display = 'none';
      deselectAllBtn.style.display = 'none';
      startTrainingBtn.style.display = 'none';

      // Show card + practice controls
      cardSection.style.display = 'block';
      practiceControls.style.display = 'flex';

      // Shuffle selected cards
      shuffleArray(selectedIndexes);

      currentIndex = 0;
      showCard(currentIndex);
    });

    /************************************************************
     * 4) Practice Controls
     ************************************************************/
    // "I Know It" => remove the current card, update count
    gotItBtn.addEventListener('click', () => {
      selectedIndexes.splice(currentIndex, 1);

      // Update the display count so user sees how many remain
      selectedCountSpan.textContent = selectedIndexes.length;

      if (selectedIndexes.length === 0) {
        alert('Awesome! You finished all selected cards.');
        endSession();
        return;
      }
      if (currentIndex >= selectedIndexes.length) {
        currentIndex = 0;
      }
      showCard(currentIndex);
    });

    // "Try Again" => keep card, move to next
    tryAgainBtn.addEventListener('click', () => {
      currentIndex++;
      if (currentIndex >= selectedIndexes.length) {
        currentIndex = 0;
      }
      showCard(currentIndex);
    });

    // "End Session"
    endSessionBtn.addEventListener('click', () => {
      endSession();
    });

    // Flip card on container click (ignore TTS button)
    cardContainer.addEventListener('click', (e) => {
      if (!e.target.classList.contains('tts-button')) {
        flipCard();
      }
    });

    /************************************************************
     * 5) TTS Button
     ************************************************************/
    ttsButton.addEventListener('click', () => {
      if (!ttsAudio.src) {
        alert('Audio not ready yet. Please try again.');
        return;
      }
      ttsAudio.play().catch(err => {
        console.log('Audio play error:', err);
        alert('Audio was blocked. Make sure your device volume is on and not in silent mode.');
      });
    });

    /************************************************************
     * Helper Functions
     ************************************************************/
    function showCard(idx) {
      // Show the front side
      cardContainer.classList.remove('card-flipped');
      isCardFlipped = false;

      const w = khmerWords[selectedIndexes[idx]];
      // Front: Khmer script
      cardFront.textContent = w.front;

      // Back: phonetic + English
      cardBack.innerHTML = `
        <div>${w.phonetic}</div>
        <div style="margin-top:8px; font-size:0.9em;">${w.english}</div>
      `;

      // Update audio source
      ttsAudio.src = w.audio;
      ttsAudio.load();
    }

    function flipCard() {
      isCardFlipped = !isCardFlipped;
      cardContainer.classList.toggle('card-flipped', isCardFlipped);
    }

    function endSession() {
      // Reset to selection
      cardsSelection.style.display = 'grid';
      selectAllBtn.style.display = 'inline-block';
      deselectAllBtn.style.display = 'inline-block';
      startTrainingBtn.style.display = 'inline-block';

      // Hide practice UI
      cardSection.style.display = 'none';
      practiceControls.style.display = 'none';

      // Clear selections
      selectedIndexes = [];
      selectedCountSpan.textContent = 0;

      // Unselect all card-option divs
      document.querySelectorAll('.card-option').forEach(div => {
        div.classList.remove('selected');
      });
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>
</body>
</html>
